{
  "type" : [ "h-entry" ],
  "properties" : {
    "name" : [ "Accessing repository dependencies in the GitHub GraphQL API" ],
    "summary" : [ "[Access to a Repositories Dependency Graph](https://developer.github.com/v4/previews/#access-to-a-repositories-dependency-graph) describes a preview API for accessing GitHub repository dependencies.\n\nTo access the preview you need to send this `Accept:` header: `application/vnd.github.hawkgirl-preview+json`\n\nBut... GitHub's own GraphQL explorer at https://developer.github.com/v4/explorer/ doesn't currently allow you to set custom HTTP headers.\n\n## Installing GraphiQL\n\nSo I decided to try https://github.com/skevy/graphiql-app - since it's mentioned in the GitHub docs [here](https://developer.github.com/v4/guides/using-the-explorer/#using-graphiql).\n\n    brew cask install graphiql\n\nThen you can launch the app from `/Applications/GraphiQL.app`.\n\nI created a personal access token at https://github.com/settings/tokens called graphiql and gave it all of the `read:` permissions.\n\nI launched the graphiql app and added the following headers:\n\n    Authorization: Bearer MY-PERSONAl-ACCESS-TOKEN\n    Accept: application/vnd.github.hawkgirl-preview+json\n\nI added `https://api.github.com/graphql` as the endpoint.\n\nI tested it by running these queries:\n```graphql\n{\n  user(login:\"simonw\") {\n    id\n    name\n    url\n    websiteUrl\n  }\n}\n```\n```graphql\n{\n  repository(owner:\"simonw\", name:\"datasette\") {\n    id\n    name\n    issues {\n      totalCount\n    }\n  }\n}\n```\n```graphql\n{\n  search(type:REPOSITORY query:\"datasette\" first:10) {\n    repositoryCount\n    edges {\n      node {\n        __typename\n        ... on Repository {\n          nameWithOwner\n          description\n        }\n      }\n    }\n  }\n}\n```\nThen I figured out this query (using autocomplete) which returns dependencies detected for a repo:\n```graphql\n{\n  repository(owner:\"simonw\", name:\"datasette\") {\n    dependencyGraphManifests {\n      totalCount\n      nodes {\n        filename\n      }\n      edges {\n        node {\n          blobPath\n          dependencies {\n            totalCount\n            nodes {\n              packageName\n              requirements\n              hasDependencies\n              packageManager\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\nThis gave me back:\n```json\n{\n  \"data\": {\n    \"repository\": {\n      \"dependencyGraphManifests\": {\n        \"totalCount\": 1,\n        \"nodes\": [\n          {\n            \"filename\": \"setup.py\"\n          }\n        ],\n        \"edges\": [\n          {\n            \"node\": {\n              \"blobPath\": \"/simonw/datasette/blob/master/setup.py\",\n              \"dependencies\": {\n                \"totalCount\": 12,\n                \"nodes\": [\n                  {\n                    \"packageName\": \"aiofiles\",\n                    \"requirements\": \"~> 0.4.0\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"click\",\n                    \"requirements\": \"~> 7.1.1\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"click-default-group\",\n                    \"requirements\": \"~> 1.2.2\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"datasette\",\n                    \"requirements\": \"\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"hupper\",\n                    \"requirements\": \"~> 1.9\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"janus\",\n                    \"requirements\": \"~> 0.4.0\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"jinja2\",\n                    \"requirements\": \"~> 2.10.3\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"mergedeep\",\n                    \"requirements\": \"~> 1.1.1\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"pint\",\n                    \"requirements\": \"~> 0.9\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"pluggy\",\n                    \"requirements\": \"~> 0.13.0\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"pyyaml\",\n                    \"requirements\": \"~> 5.3\",\n                    \"hasDependencies\": false,\n                    \"packageManager\": \"PIP\"\n                  },\n                  {\n                    \"packageName\": \"uvicorn\",\n                    \"requirements\": \"~> 0.11\",\n                    \"hasDependencies\": true,\n                    \"packageManager\": \"PIP\"\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\nSadly I really wanted to get the dependents, not the dependencies - but that's [still not available](https://stackoverflow.com/questions/58734176/how-to-use-github-api-to-get-a-repositorys-dependents-information-in-github) even as a preview API. So I [scraped them](https://github.com/dogsheep/github-to-sqlite/issues/34) instead." ],
    "featured" : [ "https://til.simonwillison.net/-/media/screenshot/github_dependencies-graphql-api.md" ],
    "url" : [ "https://til.simonwillison.net/til/til/github_dependencies-graphql-api.md" ]
  }
}
